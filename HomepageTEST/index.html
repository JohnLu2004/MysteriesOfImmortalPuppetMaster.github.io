<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mysteries Of Immortal Puppet Master TL</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to the external CSS file -->
</head>
<body>
    <div class="container">
        <!-- Book Cover and Info -->
        <div class="book-info-container">
            <div class="book-cover">
                <img src="cover50.webp" alt="Book Cover">
            </div>
            <div class="book-info">
                <h1>Mysteries Of Immortal Puppet Master</h1>
                <p>Author: Gu Zhen Ren, 蛊真人</p>
            </div>
        </div>

        <!-- Synopsis Section -->
        <div class="synopsis-section collapsed">
            <h2>Synopsis</h2>
            <p class="preview-synopsis">
                In the heart of the volcano, the remnants left behind by the sages yearned for their successors.<br>
                Risking her life, his mother obtained the Immortal Palace Seal, handing it to Ning Zhuo before her passing.<br>
                With this seal grasped firmly, he could inscribe a heart seal and command the creation of puppets.<br>
            </p>
            <p class="full-synopsis">
                While ordinary individuals struggled under the weight of just controlling a few, Ning Zhuo effortlessly commanded tens of thousands with a single gesture.<br><br>
                "Mother, I will fulfill your wishes and obtain the Immortal Palace!" he vowed.<br><br>
                Immortal Puppets; capable of spiritual secrets; their work skillful and rational.<br>
                A new realm is opened up, and things are in sync with the heavens.<br>
                The ancient bell echoes the laws. The moon dances under the clear light.<br>
                Embodied with myriad strengths, who in this world dares oppose?<br>
            </p>
            <button class="view-synopsis" onclick="toggleSynopsis()">View Synopsis</button>

            <!-- Updated Button: First Chapter -->
            <button class="read-chapter" onclick="alert('Read First Chapter')">First Chapter</button>

            <!-- New Button: Latest Chapter -->
            <button class="read-chapter" onclick="alert('Read Latest Chapter')">Latest Chapter</button>
        </div>

        <!-- Chapter List -->
        <div class="chapter-list">
            <h2>Chapters</h2>
            <div id="chapterContainer">
                <!-- JavaScript will populate this list -->
            </div>
        </div>
    </div>

    <script>
        function toggleSynopsis() {
            const synopsisSection = document.querySelector('.synopsis-section');
            synopsisSection.classList.toggle('collapsed');
            const button = synopsisSection.querySelector('button.view-synopsis');
            button.textContent = synopsisSection.classList.contains('collapsed') ? 'View Synopsis' : 'Hide Synopsis';
        }

        // Fetch chapters from the chapters.json file and populate the list
        async function loadChapters() {
            try {
                const response = await fetch('chapters.json');
                const chapters = await response.json();
                const chaptersPerBook = [231,500]; // Array of cutoff points for books
                const totalBooks = chaptersPerBook.length; // Total number of books defined by array

                const chapterContainer = document.getElementById('chapterContainer');
                chapterContainer.innerHTML = ''; // Clear any existing content

                // Group chapters into books based on cutoff points
                const books = [];
                let currentBookIndex = 0;
                let currentChapterStart = 0;

                chaptersPerBook.forEach((cutoff, index) => {
                    books[index] = chapters.slice(currentChapterStart, cutoff);
                    currentChapterStart = cutoff;
                });

                books.forEach((bookChapters, bookIndex) => {
                    // Create a container for the book
                    const bookDiv = document.createElement('div');
                    bookDiv.className = 'book';

                    // Create a button to toggle the chapters
                    const bookButton = document.createElement('button');
                    bookButton.className = 'read-chapterLIST';
                    bookButton.textContent = `Book ${bookIndex + 1}`;
                    bookButton.onclick = function () {
                        const chapterList = this.nextElementSibling;
                        chapterList.classList.toggle('hidden');
                    };
                    bookDiv.appendChild(bookButton);

                    // Create the list of chapters
                    const ul = document.createElement('ul');

                    bookChapters.forEach(chapter => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = chapter.filename;
                        a.textContent = chapter.title.slice(0, 20); // Only show the first 20 characters
                        li.appendChild(a);
                        ul.appendChild(li);
                    });
                    bookDiv.appendChild(ul);

                    chapterContainer.appendChild(bookDiv);
                });

                // Now handle auto-hide or auto-show based on screen width
                function adjustChapterVisibility() {
                    const screenWidth = window.innerWidth;
                    const thresholdWidth = 800; // Adjust this threshold as needed
                    const bookUls = document.querySelectorAll('.book ul');
                    bookUls.forEach((ul, index) => {
                        const isLastBook = index === bookUls.length - 1;
                        if (isLastBook) {
                            // Always show the last book's chapters
                            ul.classList.remove('hidden');
                        } else {
                            if (screenWidth < thresholdWidth) {
                                // For mobile users, auto-hide the books
                                ul.classList.add('hidden');
                            } else {
                                // For big screens, auto-show the books
                                ul.classList.remove('hidden');
                            }
                        }
                    });
                }

                // Initial adjustment
                adjustChapterVisibility();

                // Listen for window resize events to adjust display
                window.addEventListener('resize', adjustChapterVisibility);

            } catch (error) {
                console.error('Error loading chapters:', error);
            }
        }

        // Load the chapters when the page is loaded
        window.onload = loadChapters;
    </script>

    <!-- Remove external script.js as per instructions -->
    <!-- <script src="script.js"></script> -->

</body>
</html>
